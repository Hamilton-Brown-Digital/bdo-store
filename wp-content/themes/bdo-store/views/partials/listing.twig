{% if type == 'search' %}
    {% set posts = posts %}
    {% set itemnum = items %}
    {% set columns = items ~ 'cols' %}
{% else %}
    {% set posts = Post(acf.listing_cards) %}
    {% set itemnum = posts|length %}
    {% set columns = acf.listing_columns %}
{% endif %}

<div class="c-listing padding{% if acf.module_padding != 'padding' %} {{acf.module_padding}}{% endif %} background--{{acf.module_background}}">
    <div class="o-row o-row--no-margin">
        <div class="o-grid-container c-listing__container">
            
            {% if acf.listing_subhead %}
            <div class="c-listing__subhead">
                {{ acf.listing_subhead }}
            </div>
            {% endif %}

            {% if acf.listing_heading %}
            <div class="c-listing__heading">
                {{ acf.listing_heading }}
            </div>
            {% endif %}

            {% if not fn('is_front_page') and posts and post.parent == 0 and  post.type.slug == 'page' %}
            <div class="c-listing__count">
                {{ posts|length }} products available
            </div>
            {% endif %}

            <div class="c-listing__grid--{{ columns }} items-{{ itemnum }}">

                {% for card in posts %}

                    <div class="c-listing__card">

                        {% set type = card.post_type %}

                        {% set cardItems = {
                            type: type,
                            title: card.title,
                            url: card.link,
                            excerpt: card.preview.read_more(''),
                        } %}

                        {% if type == 'page' %}
                            {% if card.product_category %}
                                {% if card.hero_more_content != 'none' %}
                                    {% set cardItems = cardItems|merge({
                                        image: TimberImage( card.hero_image )
                                    })%}
                                {% endif %}

                                {% set cardItems = cardItems|merge({
                                    productCount: TimberTerm(card.product_category).posts()|length,
                                    color: TimberTerm(card.product_category).colour
                                })%}
                            {% endif %}
                        {% endif %}

                        {% if type == 'product' %}
                            {% if card._price is iterable %}
                                {% set price = card._price[0] %}
                            {% else %}
                                {% set price = card._price %}
                            {% endif %}

                            {% set cardItems = cardItems|merge({
                                price: price,
                                terms: card.terms( {query:{taxonomy:'product_cat'}} )|join(', '),
                                color: card.terms( {query:{taxonomy:'product_cat'}} )[0].colour
                            })%}
                        {% endif %}
                    
                        {% include "./elements/card.twig" with cardItems %}

                    </div>

                {% endfor %}

                {% do fn('wp_reset_postdata') %}

            </div>

        </div>

    </div>
</div>