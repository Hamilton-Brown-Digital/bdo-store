
{% if type == 'search' %}
    {% set posts = posts %}
{% else %}
    {% set posts = Post(acf.listing_cards) %}
{% endif %}

<div class="c-listing">

    {{ acf.listing_subhead }}

    {{ acf.listing_heading }}

    {% for card in posts %}

        {% set type = card.post_type %}

        {% set cardItems = {
            type: type,
            title: card.title,
            url: card.link,
            excerpt: card.preview.read_more('')
        } %}

        {% if type == 'page' %}
            {% if card.product_category %}
                {% set cardItems = cardItems|merge({
                    productCount: TimberTerm(card.product_category).posts()|length,
                    color: TimberTerm(card.product_category).colour
                })%}
            {% endif %}
        {% endif %}

        {% if type == 'product' %}
            {% set cardItems = cardItems|merge({
                price: card._price,
                terms: card.terms( {query:{taxonomy:'product_cat'}} )|join(', '),
                color: card.terms( {query:{taxonomy:'product_cat'}} )[0].colour
            })%}
        {% endif %}

        {% include "./elements/card.twig" with cardItems %}

    {% endfor %}

</div>